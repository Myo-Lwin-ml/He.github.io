<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>I Do Love You ‚ù§Ô∏è</title>
  <style>
    body {
      margin: 0;
      padding: 0;
      height: 100vh;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: url('Bro5.jpg') center/cover no-repeat;
      color: white;
      text-align: center;
      overflow: hidden;
    }
    h1 {
      font-size: 3em;
      margin: 0.2em;
      text-shadow: 2px 2px 6px rgba(0,0,0,0.7);
    }
    #typewrite {
      font-size: 2em;
      margin-top: 0.5em;
      white-space: pre;
      min-height: 1.5em;
    }
    button {
      margin-top: 1.5em;
      padding: 0.8em 1.4em;
      font-size: 1.1em;
      border: none;
      border-radius: 12px;
      background: #ff4d6d;
      color: white;
      cursor: pointer;
      transition: transform 0.2s;
    }
    button:hover { transform: scale(1.05); }
    dialog {
      border: none;
      border-radius: 14px;
      padding: 1.5em;
      text-align: center;
      max-width: 80%;
    }
    canvas#confetti {
      position: fixed;
      top: 0; left: 0;
      width: 100%; height: 100%;
      pointer-events: none;
    }
  </style>
</head>
<body>
  <h1 id="headline">To ROWAN</h1>
  <div id="typewrite"></div>
  <p id="message"></p>
  <p id="subtitle"></p>
  <p id="signature"> David from me, always</p>

  <button id="surpriseBtn">Open your surprise üéâ</button>
  <button id="copyBtn">Share this with you üîó</button>

  <dialog id="dialog">
    <h2>üíñ I do love you üíñ</h2>
    <p>You mean the world to me.</p>
    <button id="closeDialog">Close</button>
  </dialog>

  <canvas id="confetti"></canvas>

  <script>
    const $ = (sel) => document.querySelector(sel);
    const params = new URLSearchParams(location.search);
    const to = params.get('to') || 'ROWAN';
    const from = params.get('from') || '';
    const msg = params.get('msg');
    const subtitle = params.get('subtitle');

    $('#headline').textContent = `To ${to}`;
    $('#signature').textContent = ` YOURS DAVID ${from}, always!`;
    if (msg) $('#message').textContent = msg;
    if (subtitle) $('#subtitle').textContent = subtitle;

    const prefix = 'I do love you, ';
    const titles = ['My Babe', 'My Bro', 'ROWAN'];
    const typeEl = $('#typewrite');
    typeEl.textContent = '';

    const style = document.createElement('style');
    style.textContent = `#typewrite.glow{ animation: pulse 1.6s ease-in-out infinite; } @keyframes pulse{0%{text-shadow:0 0 8px rgba(255,255,255,.08),0 0 20px rgba(255,64,129,.06)}50%{text-shadow:0 0 12px rgba(255,255,255,.14),0 0 32px rgba(255,64,129,.12)}100%{text-shadow:0 0 8px rgba(255,255,255,.08),0 0 20px rgba(255,64,129,.06)}}`;
    document.head.appendChild(style);

    let outerIndex = 0;
    let charIndex = 0;
    let deleting = false;
    const typingSpeed = 60;
    const pauseAfter = 900;

    function tick(){
      const currentTitle = titles[outerIndex % titles.length];
      if(!deleting){
        const full = prefix + currentTitle;
        charIndex++;
        typeEl.textContent = full.slice(0, charIndex);
        typeEl.classList.add('glow');
        if(charIndex >= full.length){
          setTimeout(()=>{ deleting = true; }, pauseAfter);
        }
      } else {
        const full = prefix + currentTitle;
        charIndex--;
        if(charIndex < prefix.length){
          deleting = false;
          outerIndex++;
          charIndex = prefix.length;
        }
        typeEl.textContent = full.slice(0, charIndex);
        if(charIndex === prefix.length) typeEl.classList.remove('glow');
      }
      const delay = deleting ? typingSpeed / 1.6 : typingSpeed;
      setTimeout(tick, delay);
    }
    typeEl.textContent = prefix;
    charIndex = prefix.length;
    setTimeout(tick, 300);

    const canvas = document.getElementById('confetti');
    const ctx = canvas.getContext('2d');
    let W, H; function resize(){ W=canvas.width=innerWidth; H=canvas.height=innerHeight; }
    window.addEventListener('resize', resize, {passive:true}); resize();
    const colors = ['#fff', '#ffe08a', '#ffd1dc', '#c3f0ff', '#baffc9'];
    function Confetto(){
      this.x = Math.random()*W; this.y = -10; this.size = 6+Math.random()*8;
      this.tilt = Math.random()*10; this.tiltAngle = 0; this.tiltSpeed = .05 + Math.random()*0.07;
      this.color = colors[(Math.random()*colors.length)|0];
      this.speed = 1.5 + Math.random()*2.5;
    }
    Confetto.prototype.update = function(){ this.y += this.speed; this.tiltAngle += this.tiltSpeed; this.tilt = Math.sin(this.tiltAngle)*8; if(this.y > H+20) return false; return true; }
    Confetto.prototype.draw = function(){ ctx.beginPath(); ctx.lineWidth = this.size; ctx.strokeStyle = this.color; ctx.moveTo(this.x + this.tilt + this.size/2, this.y); ctx.lineTo(this.x + this.tilt, this.y + this.size*2); ctx.stroke(); }
    let confetti = [];
    function burst(n=140){ for(let i=0;i<n;i++){ confetti.push(new Confetto()); } cancelAnimationFrame(anim); animate(); setTimeout(()=> confetti = [], 5000); }
    let anim;
    function animate(){ anim = requestAnimationFrame(animate); ctx.clearRect(0,0,W,H); confetti = confetti.filter(c => c.update()); confetti.forEach(c => c.draw()); }

    $('#surpriseBtn').addEventListener('click', () => { burst(); $('#dialog').showModal(); });
    $('#closeDialog').addEventListener('click', () => $('#dialog').close());
    $('#copyBtn').addEventListener('click', async () => {
      const base = location.href.split('?')[0];
      const p = new URLSearchParams();
      p.set('to', to); p.set('from', from); if(msg) p.set('msg', msg); if(subtitle) p.set('subtitle', subtitle);
      const link = `${base}?${p.toString()}`;
      try{ await navigator.clipboard.writeText(link); alert('Link copied! Paste it anywhere to share.'); }
      catch{ prompt('Copy this link:', link); }
    });
    setTimeout(()=>$('#surpriseBtn').focus(), 700);
  </script>
</body>
</html>
